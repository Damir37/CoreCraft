# CoreCraft

** CoreCraft** — это сервер для игры в Minecraft, который предоставляет уникальные игровые возможности. Может включать разнообразные модификации, уникальные игровые режимы, что позволяет создать уникальную атмосферу для игроков, отличную от стандартного игрового процесса Minecraft.

## Функциональные требования:
- [ ] Регистрация, авторизация, восстановление доступ к аккаунту и т.д.
- [ ] Реферальная система
- [ ] Публикация новостей, редактирование их
- [ ] Получение данных с серверов (Версия, Онлайн, Доступность)
- [ ] Аналитика, сбор статистик: (Топ экономики, Топ по ресурсам, Топ голосующих) Сбор метрик
- [ ] Лаунчер, сессионная авторизация 
- [ ] Личные кабинет(Управление скинами; HD скины; Пополнение волюты; Голосование; Статус; Использование промокодов; )
- [ ] Вход через клиент на сервер 


## Нефункциональные требования:
- [ ] Масштабируемость (легко расширять функционал, поддерживать)
- [ ] Отказоустойчивость (бесперебойная работа)
- [ ] Доступность (Сервер всегда будет доступен, сайт и так далее)
- [ ] Согласованность (для платёжки и т.д.)
- [ ] Безопасность 


### Описание по архитектуре:
Снизу представлена схема архитектуры.

CDN - это кэширование, каких-то файлов и т.д. Грубо говоря сеть расположена на разных точек мира, допустим если наш сервер стоит в Германии, а человек заходит на сайт с Востока, чтобы все картинки прогрузились быстро или скины в игре. Мы можем их кэшировать в CDN.

Все файлы включая серверов, скинов, картинок. Мы будем использовать хранилище аля S3 (ведро) S3 - это отдельные сервера для хранения, настраивать и очень много денег тратить на это не надо. Для этого как раз таки создан S3

DNS - поскольку провайдеры уже кэширует DNS адреса (для того, чтобы быстрее перенаправлять на сайт corecraft.ru. Нам не нужно собирать ничего своего. Регистратор доменов уже располагает все точки, на которых уже зарегистрированы домены corecraft и пользователь для низкой задержки уже с ними будет связываться.

Cloudflare - Anti-DDoS  и так же "выпускатор" SSL сертификаты для безопасности и шифрование. Кроме этого уже имеет бесплатный CDN.

К нему мы подключаем почтовый сервис на SMTP, для рассылки сообщение на почту. Так же гугловский ANTIBOT. Кроме этого подключать мы можем разные внешние API (платёжки и так далее)

 Балансировщик нагрузки - достигает отказоустойчивости использует GeoDNS, для обеспечения быстрого доступа к серверу или сайту. (Временно не используется, так как у нас нет целых кластеров) 

NGINX - Обратный прокси, для связи с Frontend сервисами. Сайт, внешние GUI и так далее. Кроме этого связывается с API GateWay. А это сам шлюз, который передаёт данные на сам backend

API Gateway - это общий шлюз для связи с Backend. Перенаправляя запрос.

RabbitMq - это брокер, нужен для асинхронного общения между микросервисами



## Сервисы:
Backend Main - главный бекенд 

**AuthService**: Обеспечивает регистрацию, аутентификацию и авторизацию пользователей. Управляет сессиями, хранит токены, поддерживает различные протоколы аутентификации и обеспечивает безопасность доступа.

**UserService**: Отвечает за управление профилями пользователей, хранит личную информацию, настройки аккаунта, а также историю активности. Поддерживает обновление данных и настройки приватности.

**ReferralService**: Реализует систему рефералов, позволяя пользователям приглашать других и получать вознаграждения за приглашенных. Управляет уникальными реферальными ссылками и отслеживает выполнения условий программы.

**ContentService**: Управляет контентом на платформе(новости), включая загрузку, хранение и отображение изображений, видео, текстов и других ресурсов.

**BillingService**: Отвечает за финансовые операции, такие как пополнение счета, покупка подписок, и внутриигровые транзакции. Поддерживает интеграции с платежными шлюзами.

**AcamarService**: Специализированный сервис, получает онлайн и мониторинг сервера.

**CosmeticService**: Управляет косметическими элементами, которые пользователи могут покупать или зарабатывать. Включает скины, HD скины и другие визуальные улучшения.

**SessionService**: Обеспечивает управление сессиями пользователя, включая вход и выход, контроль времени активности и защиту от многократного входа через лаунчер и клиента. Коротко - система авторизации между клиентом и сервером, и лаунчером

**PromocodeService**: Работает с промокодами и специальными предложениями. Поддерживает генерацию, активацию и отслеживание использования промокодов.

**RCONService**: Предоставляет удаленный доступ к игровым серверам через RCON для управления серверными командами, перезагрузки серверов, модерации и мониторинга состояния.

**NotifyService**: Реализует систему уведомлений, отправляя пользователям сообщения через почту, пуш-уведомления(колокол). Поддерживает асинхронную обработку сообщений и интеграцию с внешними почтовыми сервисами.

**LauncherService**: Управляет лаунчером для загрузки и запуска игровых приложений. Обеспечивает загрузку обновлений и проверку файлов игры.

**CaseService**: Управляет системой кейсов, которые пользователи могут открывать для получения случайных наград. Включает управление содержимым кейсов, вероятностями выпадения предметов и историей открытий.

**ForumService**: Обеспечивает функциональность форума, аля интеграцию с системой авторизации.

DMZ backend - задняя часть бекенд (уже на будущее)

**LanguageService**: Поддерживает мультиязычность на сайте и т.д.



## Общий стек:
Коммуникация:

 -В**нутренние коммуникации** между высоконагруженными сервисами  **gRPC**

-**Внешний интерфейс** для фронтенда и простых CRUD операций – **REST**

-**Асинхронные процессы**, связанные с уведомлениями, аналитикой, обработкой промокодов и транзакциями – **Брокер сообщений**. RabbitMQ

База данных:

-PostgreSQL - как основная

-MySQL - для форума

-Redis - для кэширование

 Web-Сервер:

 -Nginx - для Фронтенд, бекенд и т.д.

-HAProxy - для балансировки нагрузки, бд и т.д.

Единая точка отказа:

-ETCD - Реализует паттерн Service Discovery и используется для бд и т.д.

 Сбор логов:

-Prometheus - собирает все метрики

-Grafana - отрисовывает графики на основе метрик

-Jaeger - трассировщик позволит отслеживать запросы

## Стек Backend
Язык: Golang

Фреймворк: Echo 

## Стек Frontend
Язык: TypeScript

Фреймворк: React



[![Figure 1](https://app.eraser.io/workspace/qW7drvqCyh4nLp8JOB1l/preview?elements=if6120ykX5s2-XPa-E1uuA&type=embed)](https://app.eraser.io/workspace/qW7drvqCyh4nLp8JOB1l?elements=if6120ykX5s2-XPa-E1uuA)



## Сервера:
|  Для чего |  Оборудование |  Кол-Во |  Стоимость |
| ----- | ----- | ----- | ----- |
| Nginx + Frontend (логгеры пока туда можно) | AMD EPYC 7002 Serias 4 Core 8GB RAM 160GB SSD   | 1 штука | €16.38 / месяц |
| Backend (пока все там будут сервисы) | AMD Genoa 9004 Serias 16GB RAM 160GB SSD  | 1 штука | €29.99 / месяц |
| ETCD (сильно давит диски) | AMD EPYC 7002 Serias 4 Core 8GB RAM 160GB SSD   | 1 штука | €16.38 / месяц |
| RabbitMQ | AMD EPYC 7002 Serias 4 Core 8GB RAM 160GB SSD   | 1 штука | €16.38 / месяц |
| <p>База данных и пока кэш объединим</p><p>P.S Уже куплен не требуется</p> | Intel Xeon Gold 8 Core 16GB RAM 160 + 320 SSD  | 1 штука | €19.88 / месяц |
| S3 | <ul><li>(уже подобрано)</li></ul> | 1 штука | Пока бесплатно, т.к. бета-тест |
| Для модов | Intel Xeon E3-1275V6 **RAM **64 GB **Drives **2 x 480 GB Datacenter SSD | 1 штука | €35.70 / месяц(цена может ниже стать если успеть купить) |
Что касается модового сервера:

Если мы сделаем 4 сервера модовы: выделяем каждому по 3 - 4GB памяти. Онлайн потянуть может около 300+

Домен в год стоит 900 рублей. ~

Cloudflare бесплатный



## Схема база данных:
Пока не готова



# Заключение:
По доходом, можно что-то сократить в остальном - это гибкая масштабируемая архитектура. Позволяет расширятся и легко менять сервера и поддерживать высокий рост онлайна.



## 








